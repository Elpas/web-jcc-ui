/*
* JCC LIBRARY
*
* Copyright 2018 Boris Kamenov boriskamenov@abv.bg, www.stx-dev.com
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
jcc.widgets["parallax-layer"]={version:"1.1.1",can_enhance:function(e){return"DIV"==e.nodeName&&"parallax-layer"==e.getAttribute("data-role")},enhance:function(e){e.parallaxLayer?e.parallaxLayer.refresh():new jcc.parallaxLayer(e).refresh()},unenhance:function(e){e.parallaxLayer&&e.parallaxLayer.destroy()}},jcc.parallaxLayer=function(e){var t,a,r,o,l,s,n,i,d;function c(){t=parseInt(e.dataset.speed),isNaN(t)&&(t=100)}function h(){o=l="center";var t=e.dataset.position.split(" ");if(t.length>0){if("left"==t[0]||"center"==t[0]||"right"==t[0])o=t[0];else{var a=parseInt(t[0]);isNaN(a)||(o="%"==t[0].charAt(t[0].length-1)?a+"%":a)}if(t.length>1)if("top"==t[1]||"center"==t[1]||"bottom"==t[1])l=t[1];else{a=parseInt(t[1]);isNaN(a)||(l="%"==t[1].charAt(t[1].length-1)?a+"%":a)}}}function p(){s="100%",n="auto";var t=e.dataset.size.split(" ");if(t.length>0){if("auto"==t[0]||"cover"==t[0]||"contain"==t[0])s=t[0];else{var a=parseInt(t[0]);isNaN(a)||(s="%"==t[0].charAt(t[0].length-1)?a+"%":a)}if(t.length>1)if("auto"==t[1])n=t[1];else{a=parseInt(t[1]);isNaN(a)||(n="%"==t[1].charAt(t[1].length-1)?a+"%":a)}}}function f(){if(a=r=0,parts=e.dataset.offset.split(" "),parts.length>0){var t=parseInt(parts[0]);if(isNaN(t)||(a=t),parts.length>1){t=parseInt(parts[1]);isNaN(t)||(r=t)}}}this.widget=jcc.widget,this.widget(e),this.update=function(c,h,p){var f,y,v=e.offsetWidth,g=e.offsetHeight,u=g/v;"cover"==s?(y=(f=h.width)*u,h.height>y&&(f=(y=h.height)/u)):"contain"==s?v>=g?y=(f=h.width)*u:f=(y=h.height)/u:(isNaN(s)?s.indexOf("%")>0&&(f=parseInt(s)/100*h.width):f=s,isNaN(n)?n.indexOf("%")>0&&(y=parseInt(n)/100*h.height):y=n,"auto"==s?"auto"==n?(f=v,y=g):f=y/u:"auto"==n&&(y=f*u));var x=f/v,L=y/g,N=c.left-(p.x-.5*c.width),m=c.top-(p.y-.5*c.height),w=-c.left;isNaN(o)?"left"==o?w+=0:"center"==o?w+=.5*(h.width-v):"right"==o?w+=h.width-v:w=parseInt(o)/100*h.width:w+=o,w+=a,i&&(w+=N*t/100);var b=-c.top;isNaN(l)?b+="top"==l?0:"center"==l?.5*(h.height-g):"bottom"==l?h.height-g:parseInt(l)/100*h.height:b+=l,b+=r,d&&(b+=m*t/100),e.style.transform="translate("+w+"px,"+b+"px) scale("+x+","+L+")"},this.setOptions=function(t){var a=!1;for(var r in t)"number"!=typeof t[r]&&"string"!=typeof t[r]||(e.dataset[r]=t[r].toString(),"speed"==r?c():"position"==r?h():"size"==r?p():"offset"==r?f():a=!0);a?this.refresh():e.parentNode.parallax.update()},this.refresh=function(){e.parentNode.dataset.role&&"parallax"==e.parentNode.dataset.role?(this.destroy(),e.parallaxLayer=this,e.dataset.speed&&0!=e.dataset.speed.length||(e.dataset.speed=100),e.dataset.size&&0!=e.dataset.size.length||(e.dataset.size="100% 100%"),e.dataset.position&&0!=e.dataset.position.length||(e.dataset.position="center center"),e.dataset.offset&&0!=e.dataset.offset.length||(e.dataset.offset="0 0"),c(),h(),p(),f(),i="horizontal"==e.parentNode.dataset.direction||"all"==e.parentNode.dataset.direction,d="vertical"==e.parentNode.dataset.direction||"all"==e.parentNode.dataset.direction,e.classList.add("jcc-parallax-layer"),jcc.dispatchCustomEvent(e.parentNode,"e-layer-loaded",{bubbles:!1,cancelable:!1,detail:e})):alert("JCC: An 'parallax-layer' node must be a direct child of a 'parallax'. Please revise your markup.")},this.destroy=function(){e.parallaxLayer&&(e.classList.remove("jcc-parallax-layer"),delete e.parallaxLayer)}},jcc.widgets.parallax={version:"1.0",can_enhance:function(e){return"DIV"==e.nodeName&&"parallax"==e.getAttribute("data-role")},enhance:function(e){e.parallax?e.parallax.refresh():new jcc.parallax(e).refresh()},unenhance:function(e){e.parallax&&e.parallax.destroy()}},jcc.parallax=function(el){var layers,layersLoaded,ocx,ocy,oox,ooy;this.widget=jcc.widget,this.widget(el);var isChrome=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);function update(){var e=jcc.getElementRect(el),t=jcc.getViewportRect(),a={x:0,y:0};isNaN(ocx)?a.x="left"==ocx?0:"center"==ocx?.5*t.width:"right"==ocx?t.width:parseInt(ocx)/100*t.width:a.x=ocx,a.x+=oox,isNaN(ocy)?a.y="top"==ocy?0:"center"==ocy?.5*t.height:"bottom"==ocy?t.height:parseInt(ocy)/100*t.height:a.y=ocy,a.y+=ooy;for(var r=0;r<layers.length;r++)if(1==layersLoaded[r]){var o=layers[r].parallaxLayer;o&&o.update(e,t,a)}}function onPageResize(){if(isChrome){var e=el.style.display;el.style.display="none";el.offsetHeight;el.style.display=e}update()}function onLayerLoaded(event){if(layers){el.dataset.eLayerLoaded&&el.dataset.eLayerLoaded.length>0&&eval(el.dataset.eLayerLoaded);for(var layer=event.detail,i=0;i<layers.length;i++)if(layers[i]==layer){layersLoaded[i]=!0;break}for(var allLoaded=!0,i=0;i<layersLoaded.length;i++)if(0==layersLoaded[i]){allLoaded=!1;break}allLoaded&&(update(),jcc.dispatchCustomEvent(el,"e-loaded",{bubbles:!1,cancelable:!1}))}}function onELoaded(event){el.dataset.eLoaded&&el.dataset.eLoaded.length>0&&eval(el.dataset.eLoaded)}function readOrthoCenter(){ocx=ocy="center";var e=el.dataset.orthoCenter.split(" ");if(e.length>0){if("left"==e[0]||"center"==e[0]||"right"==e[0])ocx=e[0];else{var t=parseInt(e[0]);isNaN(t)||(ocx="%"==e[0].charAt(e[0].length-1)?t+"%":t)}if(e.length>1)if("top"==e[1]||"center"==e[1]||"bottom"==e[1])ocy=e[1];else{t=parseInt(e[1]);isNaN(t)||(ocy="%"==e[1].charAt(e[1].length-1)?t+"%":t)}}}function readOrthoOffset(){if(oox=ooy=0,parts=el.dataset.orthoOffset.split(" "),parts.length>0){var e=parseInt(parts[0]);if(isNaN(e)||(oox=e),parts.length>1){e=parseInt(parts[1]);isNaN(e)||(ooy=e)}}}this.setOptions=function(e){var t=!1;for(var a in e)"number"!=typeof e[a]&&"string"!=typeof e[a]||(el.dataset[a]=e[a].toString(),"orthoCenter"==a?readOrthoCenter():"orthoOffset"==a?readOrthoOffset():t=!0);t?this.refresh():update()},this.refresh=function(){"horizontal"!=el.dataset.direction&&"vertical"!=el.dataset.direction&&"all"!=el.dataset.direction&&(el.dataset.direction="vertical"),el.dataset.orthoCenter&&0!=el.dataset.orthoCenter.length||(el.dataset.orthoCenter="center center"),el.dataset.orthoOffset&&0!=el.dataset.orthoOffset.length||(el.dataset.orthoOffset="0 0"),this.destroy(),el.parallax=this,readOrthoCenter(),readOrthoOffset(),"static"==jcc.getComputedStyle(el,"position")&&el.classList.add("jcc-parallax-relative"),layers=el.querySelectorAll("div[data-role$='parallax-layer']"),layersLoaded=[];for(var e=0;e<layers.length;e++)layersLoaded.push(!1);el.classList.add("jcc-parallax");var t=el.parentNode;do{t==document.body?window.addEventListener("scroll",update,!1):t.addEventListener("scroll",update,!1)}while(t!=document.body&&(t=t.parentNode));window.addEventListener("resize",onPageResize,!1),el.addEventListener("e-moved",update,!1),jcc.repositionMonitor.addElement(el),el.addEventListener("e-layer-loaded",onLayerLoaded,!1),el.addEventListener("e-loaded",onELoaded,!1)},this.destroy=function(){if(el.parallax){el.removeEventListener("e-loaded",onELoaded),el.removeEventListener("e-layer-loaded",onLayerLoaded);var e=el.parentNode;do{e==document.body?window.removeEventListener("scroll",update):e.removeEventListener("scroll",update)}while(e!=document.body&&(e=e.parentNode));window.removeEventListener("resize",onPageResize),el.removeEventListener("e-moved",update),jcc.repositionMonitor.removeElement(el),el.classList.remove("jcc-parallax"),el.classList.remove("jcc-parallax-relative"),layers=void 0,layersLoaded=void 0,delete el.parallax}}};